# 組合員推計ロジック仕様書

## 概要
このドキュメントは、2025年を基準年として2030年以降の組合員数を推計するためのロジックを定義したものです。

## 推計方針

### 年齢層別の推計方式
- **20-44歳**: 100% シェア率維持（若年層の新規加入促進）
- **45-49歳**: コーホート70% + シェア率30%（移行期）
- **50-59歳**: コーホート80% + シェア率20%（安定期）
- **60歳以上**: コーホート90% + シェア率10%（高齢期）

### 基本的な考え方
- 若年層（20-44歳）は新規加入促進策により、人口に対するシェア率を維持
- 中年層（45-59歳）は既存組合員の継続と一部新規加入の混合
- 高齢層（60歳以上）は主に既存組合員の年齢進行を反映

## 推計計算式

### 基本式
```
将来組合員数[t年][age] = 
  (コーホート推計値 × コーホート係数) + (シェア率推計値 × シェア率係数)
```

### 詳細計算

#### ① コーホート推計値
```
コーホート推計値 = 
  組合員数[t-5年][age-5] × 人口増減率[都道府県][age-5→age][t-5年→t年]
```

#### ② シェア率推計値
```
シェア率推計値 = 
  人口[t年][age] × 基準シェア率[2025年][age]
```

## 具体的な計算手順

### Step 1: 基準年（2025年）のシェア率を計算
```
基準シェア率[age] = 組合員数[2025][age] / 人口[2025][age]
```

### Step 2: 人口増減率の取得
`public/data/population_change_rates/` から該当する増減率データを取得

### Step 3: 年齢層別の推計

#### 20-44歳の場合
```
組合員数[t年][age] = 人口[t年][age] × 基準シェア率[age]
```

#### 45-49歳の場合
```
コーホート = 組合員[t-5年][40-44] × 人口増減率[40-44→45-49] × 0.7
シェア率 = 人口[t年][45-49] × 基準シェア率[45-49] × 0.3
組合員数[t年][45-49] = コーホート + シェア率
```

#### 50-59歳の場合
```
コーホート = 組合員[t-5年][age-5] × 人口増減率[age-5→age] × 0.8
シェア率 = 人口[t年][age] × 基準シェア率[age] × 0.2
組合員数[t年][age] = コーホート + シェア率
```

#### 60歳以上の場合
```
コーホート = 組合員[t-5年][age-5] × 人口増減率[age-5→age] × 生存率[age] × 0.9
シェア率 = 人口[t年][age] × 基準シェア率[age] × 0.1
組合員数[t年][age] = コーホート + シェア率
```

## 特別な考慮事項

### 生存率の適用（70歳以上）
```javascript
const survivalRates = {
  '70-74': 0.95,
  '75-79': 0.90,
  '80-84': 0.80,
  '85-89': 0.65,
  '90-94': 0.40,
  '95-99': 0.20
}
```

### エッジケース処理
- **人口が0の場合**: 組合員数も0とする
- **新設年齢層（0-19歳）**: 常に0（組合員対象外）
- **データ欠損**: 前後の年齢層から線形補間

## 実装例：北海道45-49歳（2025→2030年）

```javascript
// 入力データ
const inputData = {
  pop_40_44_2025: 297,      // 千人
  coop_40_44_2025: 59.4,    // 千人
  pop_45_49_2025: 340,      // 千人
  coop_45_49_2025: 68,      // 千人
  pop_45_49_2030: 281,      // 千人（推計）
  popChangeRate: -0.053     // -5.3%（40-44→45-49の人口増減率）
}

// 基準シェア率
const baseShareRate = 68 / 340 = 0.20 // 20%

// コーホート推計
const cohortValue = 59.4 * (1 - 0.053) = 56.3

// シェア率推計
const shareValue = 281 * 0.20 = 56.2

// 最終推計（係数適用）
const result = (56.3 * 0.7) + (56.2 * 0.3) = 39.4 + 16.9 = 56.3千人
```

## データソース

### 必要なデータファイル
1. **人口データ**: `public/data/population_api/population_[year].json`
2. **組合員データ**: `public/data/coop-members/coop_members_[prefCode]_[year].json`
3. **人口増減率**: `public/data/population_change_rates/change_rates_[prefCode].json`

### データ形式
- 人口・組合員数: 千人単位
- 増減率: パーセント（-5.3% = -0.053）
- 都道府県コード: 01-47（全国は00000）

## 更新履歴
- 2024年12月: 初版作成
- 推計方針を20-34歳から20-44歳に拡大
- 年齢層別調整係数の導入により、団塊ジュニア世代の影響を平滑化