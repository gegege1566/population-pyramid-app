# 人口ピラミッド可視化アプリケーション - プロジェクト概要

## 現在の状況
このプロジェクトは人口ピラミッド可視化アプリケーションで、以下の機能が完成しています：

### 完成済み機能
1. **都道府県別人口ピラミッド表示**
   - 全国・都道府県別の人口データ表示
   - 2025年〜2050年の将来推計データ対応
   - 動的スケール計算による最適な表示

2. **データ処理の改善**
   - 全国データと都道府県データの単位統一問題を解決
   - 全国データ：実人数 → 千人単位グラフ表示
   - 都道府県データ：千人単位 → そのまま表示

3. **年度比較機能（最新改善版）**
   - **初期設定**: 2025年と2035年で比較
   - **重ね描画**: 同一グラフに2年度のデータを重ねて表示
   - **視覚的差別化**: 
     - 2025年: 塗りつぶしバー (opacity 0.7)
     - 2035年: 濃い色の細い点線囲みバー (stroke-width: 1, stroke-dasharray: '3,3')
   - **左右一杯表示**: グラフ幅をコンテナ幅一杯に設定
   - **凡例**: 下部中央に男性・女性別に年度を区別して表示

### 技術的詳細
- **フレームワーク**: React 19 + TypeScript
- **可視化**: D3.js
- **データソース**: e-Stat API + ローカルJSONファイル
- **プロセス管理**: PM2

### データ処理の重要なポイント
- **全国データ**: prefectureCode='00000'で識別、実人数データを千人単位に変換してグラフ表示
- **都道府県データ**: 千人単位データをそのまま使用

## 未実装の機能（今後の課題）

### 組合員数推計機能の実装予定
この機能はまだ実装されておらず、将来の実装が予定されています：

#### 実装予定の内容
1. **ボタン追加**
   - ヘッダーに「組合員数推計」ボタンを追加
   - オン/オフ切り替え可能

2. **データ構造**
   ```typescript
   export interface CoopMemberData {
     year: number;
     prefecture: string;
     prefectureCode: string;
     ageGroup: string;
     memberCount: number; // 組合員数（千人単位）
   }
   ```

3. **表示方法**
   - 人口ピラミッドの中央にオレンジ色のバーでオーバーレイ表示
   - 組合員の年齢別分布を人口データと同じスケールで表示
   - ツールチップで詳細データ表示

4. **データファイル構造**
   ```
   public/data/coop-members/
   ├── members_2025.json  // 2025年データ
   ├── members_2030.json  // 2030年データ（将来）
   └── members_2035.json  // 2035年データ（将来）
   ```

5. **サービスクラス**
   - `CoopMemberService`: 組合員データの読み込み・キャッシュ管理
   - 年度・都道府県別のデータ可用性チェック

6. **実装の考慮点**
   - 初期実装は2025年全国データのみ
   - 将来的に都道府県別・複数年度対応
   - 既存の人口ピラミッド表示に影響を与えない設計

#### 実装時の注意事項
- 組合員データは農業協同組合員の推計値
- 人口データとは独立したデータセット
- 表示時は人口データと同じ千人単位で統一
- 既存のPopulationPyramidコンポーネントに条件付きで機能追加

## ファイル構成
```
src/
├── components/
│   ├── PopulationPyramid.tsx          # メイン人口ピラミッド表示
│   ├── YearComparisonDemo.tsx         # 年度比較（重ね描画）
│   ├── PopulationStats.tsx            # 人口統計表示
│   └── PrefectureSelector.tsx         # 都道府県選択UI
├── services/
│   └── localDataService.ts            # データ処理・スケール計算
├── types/
│   └── population.ts                  # 型定義
└── hooks/
    ├── usePrefectureData.ts           # 単一都道府県データ管理
    └── useMultiplePrefectureData.ts   # 複数都道府県データ管理
```

## 最新のコミット状況
現在のバージョンでは年度比較機能が完全に動作し、2つの年度のデータを重ねて表示できる状態です。
組合員数推計機能の実装は今後の課題として残っています。